<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¡ vs ç¾é‡‘</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#000000" />
  <link rel="icon" href="icon.png">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", sans-serif;
      background: #121212;
      color: #f5f5f5;
      margin: 0;
      padding: 1rem;
    }
    .container {
      max-width: 480px;
      margin: 3rem auto 0 auto;
      padding: 1.5rem;
      background: #1e1e1e;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.4);
      position: relative;
    }
    .theme-toggle-wrapper {
      position: absolute;
      top: -2.5rem;
      right: 0;
      display: flex;
      align-items: center;
      gap: 0.3rem;
      font-size: 1.2rem;
    }
    h2 {
      text-align: center;
      margin-bottom: 1rem;
      color: #ffffff;
    }
    body.light h2 {
      color: #000000;
    }
    label { display: block; margin: 0.5rem 0 0.2rem; font-weight: bold; color: #dddddd; }
    input, select {
      width: 100%; padding: 0.6rem; margin-bottom: 0.8rem;
      font-size: 1rem; border-radius: 8px; border: 1px solid #555;
      background-color: #2a2a2a; color: #f5f5f5;
    }
    button {
      width: 100%; padding: 0.8rem; font-size: 1.1rem;
      border-radius: 8px; border: none;
      background-color: #ffffff; color: #000000;
      font-weight: bold; margin-top: 1rem;
    }
    .notice { font-size: 0.9rem; color: #bbbbbb; margin-top: -0.6rem; margin-bottom: 1rem; }
    .result {
      margin-top: 1.5rem; padding: 1rem; background: #2e2e2e;
      border-radius: 8px; font-size: 1rem;
    }
    .checkbox-label {
      display: flex;
      align-items: center;
      gap: 0.5em;
      margin-top: 0.5rem;
      margin-bottom: 0.8rem;
      font-size: 0.95rem;
    }
    .checkbox-label input[type="checkbox"] {
      width: auto;
      margin: 0;
    }
    .switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 26px;
    }
    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0; left: 0;
      right: 0; bottom: 0;
      background-color: #ccc;
      transition: 0.4s;
      border-radius: 34px;
    }
    .slider:before {
      position: absolute;
      content: "";
      height: 20px; width: 20px;
      left: 3px; bottom: 3px;
      background-color: white;
      transition: 0.4s;
      border-radius: 50%;
    }
    input:checked + .slider {
      background-color: #2196F3;
    }
    input:checked + .slider:before {
      transform: translateX(24px);
    }
    body.light {
      background: #f4f4f4;
      color: #111111;
    }
    body.light .container {
      background: #ffffff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    body.light input, body.light select {
      background-color: #ffffff;
      color: #000;
      border: 1px solid #ccc;
    }
    body.light .result {
      background: #eeeeee;
      color: #000;
    }
    body.light button {
      background-color: #000;
      color: #fff;
    }
    body.light label {
      color: #333;
    }
    body.light .notice {
      color: #666;
    }
    .settings {
      display: none;
    }
  </style>
</head>
<body>
<div class="container" id="mainPage">
  <div class="theme-toggle-wrapper">
    ğŸŒ™<label class="switch">
      <input type="checkbox" id="themeSwitch">
      <span class="slider"></span>
    </label>â˜€ï¸
  </div>
  <h2>ğŸ’± å¡ vs ç¾é‡‘</h2>
  <button onclick="toggleSettings()">âš™ï¸ è‡ªè¨‚åŒ¯ç‡è¨­å®š</button>
  <label>å¹£åˆ¥</label>
  <select id="currency">
    <option value="JPY">ğŸ‡¯ğŸ‡µ æ—¥åœ“ (JPY)</option>
    <option value="KRW">ğŸ‡°ğŸ‡· éŸ“å…ƒ (KRW)</option>
    <option value="USD">ğŸ‡ºğŸ‡¸ ç¾å…ƒ (USD)</option>
    <option value="EUR">ğŸ‡ªğŸ‡º æ­å…ƒ (EUR)</option>
  </select>
  <label>å•†å“åƒ¹æ ¼ï¼ˆä»¥æ‰€é¸å¹£åˆ¥è¨ˆï¼‰</label>
  <input type="number" id="amount" value="10000">
  <h3>ğŸ’³ è‡ªè¨‚åŒ¯ç‡å¡ï¼ˆé›™å¹£å¡æˆ–ç¾é‡‘ï¼‰</h3>
  <label>åŒ¯ç‡</label>
  <input type="number" step="0.0001" id="dualRate" value="0.219">
  <label>å›é¥‹ç™¾åˆ†æ¯”ï¼ˆç¾é‡‘è«‹å¡« 0ï¼‰</label>
  <input type="number" step="0.1" id="dualCashback" value="1">
  <h3>ğŸ’³ ä¸€èˆ¬ä¿¡ç”¨å¡</h3>
  <label>ä¿¡ç”¨å¡åŒ¯ç‡</label>
  <input type="number" step="0.0001" id="cardRate" value="0.2225">
  <div id="rateNotice" class="notice"></div>
  <div id="rateTime" class="notice"></div>
  <button onclick="loadRate()">é‡æ–°å–å¾—å³æ™‚åŒ¯ç‡</button>
  <label>ä¿¡ç”¨å¡å›é¥‹ç™¾åˆ†æ¯”</label>
  <input type="number" step="0.1" id="cardCashback" value="3">
  <label class="checkbox-label">
    <input type="checkbox" id="includeFee" checked>
    è€ƒæ…® 1.5% æµ·å¤–æ‰‹çºŒè²»
  </label>
  <button onclick="calculate()">è¨ˆç®—ï¼</button>
  <div class="result" id="output"></div>
</div>
<div class="container settings" id="settingsPage">
  <h2>âš™ï¸ è¨­å®šé è¨­å€¼</h2>
  <label>å¹£åˆ¥</label>
  <select id="settingCurrency" onchange="updateSettingInputs()">
    <option value="JPY">ğŸ‡¯ğŸ‡µ æ—¥åœ“ (JPY)</option>
    <option value="KRW">ğŸ‡°ğŸ‡· éŸ“å…ƒ (KRW)</option>
    <option value="USD">ğŸ‡ºğŸ‡¸ ç¾å…ƒ (USD)</option>
    <option value="EUR">ğŸ‡ªğŸ‡º æ­å…ƒ (EUR)</option>
  </select>
  <label>è‡ªè¨‚åŒ¯ç‡ï¼ˆé è¨­ï¼‰</label>
  <input type="number" id="defaultDualRate" step="0.0001">
  <label>è‡ªè¨‚å›é¥‹ç™¾åˆ†æ¯”ï¼ˆé è¨­ï¼‰</label>
  <input type="number" id="defaultDualCashback" step="0.1">
  <button onclick="saveSettings()">ğŸ’¾ å„²å­˜è¨­å®š</button>
  <button onclick="toggleSettings()">â†©ï¸ è¿”å›ä¸»ç•«é¢</button>
</div>
<script>
  function toggleSettings() {
    const isSettingsOpen = document.getElementById("settingsPage").style.display === "block";
    document.getElementById("mainPage").style.display = isSettingsOpen ? "block" : "none";
    document.getElementById("settingsPage").style.display = isSettingsOpen ? "none" : "block";

    if (!isSettingsOpen) {
      const cur = document.getElementById("currency").value;
      document.getElementById("settingCurrency").value = cur;
      updateSettingInputs();
    }
  }

  function updateSettingInputs() {
    const selected = document.getElementById("settingCurrency").value;
    document.getElementById("defaultDualRate").value = localStorage.getItem(`defaultDualRate_${selected}`) || "";
    document.getElementById("defaultDualCashback").value = localStorage.getItem(`defaultDualCashback_${selected}`) || "";
  }

  function saveSettings() {
    const cur = document.getElementById("settingCurrency").value;
    const rate = document.getElementById("defaultDualRate").value;
    const cashback = document.getElementById("defaultDualCashback").value;
    localStorage.setItem(`defaultDualRate_${cur}`, rate);
    localStorage.setItem(`defaultDualCashback_${cur}`, cashback);

    document.getElementById("currency").value = cur;
    document.getElementById("dualRate").value = rate;
    document.getElementById("dualCashback").value = cashback;

    alert("è¨­å®šå·²å„²å­˜ï¼");
    toggleSettings();
  }

  document.addEventListener("DOMContentLoaded", () => {
    const savedTheme = localStorage.getItem("themeMode");
    if (savedTheme === "light") {
      document.body.classList.add("light");
      document.getElementById("themeSwitch").checked = true;
    }
    const savedFields = ["amount", "dualRate", "dualCashback", "cardRate", "cardCashback"];
    savedFields.forEach(id => {
      if (localStorage.getItem(id)) {
        document.getElementById(id).value = localStorage.getItem(id);
      }
    });
    const cur = document.getElementById("currency").value;
    const defaultRate = localStorage.getItem(`defaultDualRate_${cur}`);
    const defaultCashback = localStorage.getItem(`defaultDualCashback_${cur}`);
    document.getElementById("dualRate").value = defaultRate || "";
    document.getElementById("dualCashback").value = defaultCashback || "";
    document.getElementById("currency").addEventListener("change", () => {
      loadRate();
      const cur = document.getElementById("currency").value;
      const defaultRate = localStorage.getItem(`defaultDualRate_${cur}`);
      const defaultCashback = localStorage.getItem(`defaultDualCashback_${cur}`);
      document.getElementById("dualRate").value = defaultRate || "";
      document.getElementById("dualCashback").value = defaultCashback || "";
    });
    document.getElementById("themeSwitch").addEventListener("change", function () {
      const isLight = this.checked;
      document.body.classList.toggle("light", isLight);
      localStorage.setItem("themeMode", isLight ? "light" : "dark");
    });
    loadRate();
  });

  function loadRate() {
    const currency = document.getElementById("currency").value;
    document.getElementById("rateNotice").textContent = "è¼‰å…¥ä¸­... â³";
    setTimeout(() => {
      fetch("https://open.er-api.com/v6/latest/TWD")
        .then(response => response.json())
        .then(data => {
          const toTWD = 1 / data.rates[currency];
          document.getElementById("cardRate").value = toTWD.toFixed(4);
          const now = new Date();
          const timeStr = now.toLocaleTimeString("zh-Hant", { hour: '2-digit', minute: '2-digit', second: '2-digit' });
          document.getElementById("rateTime").textContent = `æ›´æ–°æ™‚é–“ï¼š${timeStr}`;
          document.getElementById("rateNotice").textContent = `å·²è‡ªå‹•è¼‰å…¥å³æ™‚åŒ¯ç‡ï¼ˆ1 ${currency} â‰ˆ ${toTWD.toFixed(4)} TWDï¼‰`;
        })
        .catch(() => {
          document.getElementById("rateNotice").textContent = "âš ï¸ ç„¡æ³•å–å¾—å³æ™‚åŒ¯ç‡ï¼Œè«‹æ‰‹å‹•è¼¸å…¥ã€‚";
        });
    }, 1000);
  }

  function calculate() {
    const persistFields = ["amount", "dualRate", "dualCashback", "cardRate", "cardCashback"];
    persistFields.forEach(id => {
      localStorage.setItem(id, document.getElementById(id).value);
    });

    const amount = parseFloat(document.getElementById("amount").value);
    const dual = amount * parseFloat(document.getElementById("dualRate").value);
    const dualFinal = dual * (1 - parseFloat(document.getElementById("dualCashback").value) / 100);
    const cardRate = parseFloat(document.getElementById("cardRate").value);
    const cardFinalRate = document.getElementById("includeFee").checked ? cardRate * 1.015 : cardRate;
    const card = amount * cardFinalRate;
    const cardFinal = card * (1 - parseFloat(document.getElementById("cardCashback").value) / 100);
    let suggestion = "âœ… å»ºè­°ä½¿ç”¨è‡ªè¨‚åŒ¯ç‡å¡ï¼";
    if (cardFinal < dualFinal) suggestion = "âœ… å»ºè­°ä½¿ç”¨ä¸€èˆ¬ä¿¡ç”¨å¡ï¼";
    const savings = Math.abs(dualFinal - cardFinal);
    const fries = Math.floor(savings / 30);
    document.getElementById("output").innerHTML = `
      <strong>å•†å“åƒ¹æ ¼ï¼š</strong> ${amount.toLocaleString()} ${document.getElementById("currency").value}<br><br>
      <strong>è‡ªè¨‚åŒ¯ç‡å¡ï¼š</strong> ${dualFinal.toFixed(2)} å…ƒ<br>
      <strong>ä¸€èˆ¬ä¿¡ç”¨å¡ï¼š</strong> ${cardFinal.toFixed(2)} å…ƒ<br><br>
      <strong>${suggestion}</strong><br>
      ğŸ’° å·®åƒ¹ç´„ ${savings.toFixed(2)} å…ƒï¼Œå¯å¤šåƒ ${fries} åŒ…è–¯æ¢ ğŸŸ
    `;
  }
</script>
</body>
</html>
